<!doctype html><html><head><title>What is CQRS?</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><meta property="og:title" content="What is CQRS?"><meta property="og:description" content="What is CQRS (Command Query Responsibility Segregation)"><meta property="og:type" content="article"><meta property="og:url" content="https://johanbasson.net/posts/what-is-cqrs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-09T02:26:55+02:00"><meta property="article:modified_time" content="2022-08-09T02:26:55+02:00"><meta name=description content="What is CQRS (Command Query Responsibility Segregation)"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-LD225NRQJ0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LD225NRQJ0",{anonymize_ip:!1})}</script><script>!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!==0&&fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"johangwbasson@gmail.com",utcoffset:"1"})),sessionStorage.setItem("_swa","1")</script><script data-goatcounter=https://johanbasson.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Johan Basson - Java & Web Developer</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20></a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/what-is-cqrs/cqrs.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/johan_hu34de875575dd30b1bbc8c14e9af6412b_85075_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Johan Basson</h5><p>Tuesday, August 9, 2022</p></div><div class=title><h1>What is CQRS?</h1></div><div class=post-content id=post-content><p>CQRS is a pattern where the write and read sides are split in an application, maximizing performance and scalability. CQRS is an abbreviation for Command, Query Responsibility Segregation. A CQRS application is composed of commands, queries, and events. Let&rsquo;s look at the building blocks of a CQRS application.</p><h2 id=the-write-side>The Write Side</h2><p><strong>Aggregate</strong></p><p>An Aggregate is a collection of one or more entities that can be seen as a single unit. For example an Order with line items, a Shopping Cart with each product and quantity.</p><p><strong>Commands</strong></p><p>Commands are instructions for modifying the state of an Aggregate. It is an action that can be performed.</p><p><strong>Event</strong></p><p>An event is a data structure that captures the state change in an Aggregate. Events are published in the system. One or more consumers listen to the event and perform an action. The most common action is to update a view database. Events are immutable and are stored in an Event store.</p><p><strong>Event Store</strong></p><p>Each immutable event is stored in an event source database. The event itself is only ever inserted and will not change for the lifetime of the application.</p><p><strong>Event Sourcing.</strong></p><p>An Aggregates state is composed of one or more events. An aggregate is hydrated by loading all events associated with the aggregate and applying it to itself (the aggregate instance). The event store with its events becomes the source of truth.</p><p><strong>View database</strong></p><p>The view database is your data warehouse, where you store all information in an accessible way for usage by a REST API or other querying mechanism. The data in the views database is built up in time using events. As each event contains the changes for the aggregate, we can use this information to keep the data in the view database in sync with the Event store.</p><h2 id=the-read-side>The Read Side</h2><p><strong>Query</strong></p><p>A query is a data structure that contains parameters for querying data. Typically this would be page number, row count, any search parameters, etc.</p><p><strong>Query Handler</strong></p><p>The query handler receives the query object and queries the database. It uses the information contained in the query object to retrieve specific information. Its job is to take the query input parameters, query the database, and return the information from the database to the caller, in this case, the REST API.</p><h2 id=understanding-how-each-component-fits-together-to-form-the-big-picture>Understanding how each component fits together to form the big picture.</h2><p>Here is a simplified diagram of how each component fits together.</p><p><img src=cqrs-components.png alt="CQRS Components" title="CQRS Components"></p><ol><li>A command is received from REST API, but note that the command can originate from anywhere.</li><li>The command is sent to the CommandBus which sends it to an Aggregate handler. If the Aggregate does not exist, a new instance is constructed.</li><li>The Aggregate handler handles the specific command in this case the CreateUserCommand. It emits a UserCreatedEvent.</li><li>The UserCreatedEvent is appended/stored in the event store.</li><li>When the event has been stored successfully, it is sent to the EventBus which sends the event to one or more event handlers.</li><li>In this case, we have a UserView service that receives the UserCreatedEvent.</li><li>The new user is inserted into the user&rsquo;s table.</li><li>A query object is constructed in this case a RetreiveUserQuery.</li><li>It is sent to the QueryBus.</li><li>The QueryBus executes the correct QueryHandler in this case the UserView service.</li><li>The UserView service queries the database, retrieves the data, and returns it to the caller.</li><li>The resulting data is returned to the API caller.</li></ol><p>This is a quick overview of how CQRS work. Till next time.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/hugo-toha/hugo-toha.github.io/edit/main/content/posts/what-is-cqrs/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:johangwbasson@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>johangwbasson@gmail.com</span></a></li><li><a href=https://github.com/johangwbasson target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>johangwbasson</span></a></li><li><a href=https://www.linkedin.com/in/johangwbasson target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Johan Basson</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+27787958927</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright Johan Basson.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>