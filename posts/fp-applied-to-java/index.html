<!doctype html><html><head><title>Functional Principles applied to Java</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><meta property="og:title" content="Functional Principles applied to Java"><meta property="og:description" content="Functional Programming principles applied to Java"><meta property="og:type" content="article"><meta property="og:url" content="https://johanbasson.net/posts/fp-applied-to-java/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-13T08:33:10+02:00"><meta property="article:modified_time" content="2022-07-13T08:33:10+02:00"><meta name=description content="Functional Programming principles applied to Java"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-LD225NRQJ0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LD225NRQJ0",{anonymize_ip:!1})}</script><script>!sessionStorage.getItem("_swa")&&document.referrer.indexOf(location.protocol+"//"+location.host)!==0&&fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer,screen:screen.width+"x"+screen.height,user:"johangwbasson@gmail.com",utcoffset:"1"})),sessionStorage.setItem("_swa","1")</script><script data-goatcounter=https://johanbasson.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Johan Basson - Java & Web Developer</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20></a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/fp-applied-to-java/keyboard.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/johan_hu34de875575dd30b1bbc8c14e9af6412b_85075_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Johan Basson</h5><p>Wednesday, July 13, 2022</p></div><div class=title><h1>Functional Principles applied to Java</h1></div><div class=post-content id=post-content><p>Java is not a pure functional programming language, but we can apply the functional programming principles quite easily with it. Note the next example is my interpretation and implementation of applying functional programming principles.</p><h3 id=example-use-case>Example Use Case</h3><p>We will build a simple endpoint that would perform an authentication of a user and if successful generate a JWT token for accessing our API. If the authentication is unsuccessful we will return an error.</p><p>We will be using a functional programming library named Vavr <a href=https://www.vavr.io/>https://www.vavr.io/</a>. For the server, we&rsquo;ll be using Javalin <a href=https://javalin.io/>https://javalin.io/</a>.</p><p>Here is a bare minimum server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> io.javalin.Javalin<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        Javalin app <span style=color:#f92672>=</span> Javalin<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>cfg <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>            cfg<span style=color:#f92672>.</span><span style=color:#a6e22e>enableDevLogging</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>            cfg<span style=color:#f92672>.</span><span style=color:#a6e22e>enableCorsForAllOrigins</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>  
</span></span><span style=display:flex><span>        app<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>(</span>8080<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span> 
</span></span></code></pre></div><p>The request type will look like this. Note we will be using Lombok&rsquo;s @Value annotation to make it immutable.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> lombok.Value<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Value</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticateRequest</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    String email<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    String password<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Or we can utilize Java&rsquo;s records to create an immutable data structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> record <span style=color:#a6e22e>AuthenticateRequest</span><span style=color:#f92672>(</span>String email<span style=color:#f92672>,</span> String password<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span></code></pre></div><p>We also need a Token type class for data transfer:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> record <span style=color:#a6e22e>JwtToken</span><span style=color:#f92672>(</span>String token<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span></code></pre></div><h3 id=business-logic>Business logic</h3><p>Here is the authentication business logic:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Authenticate</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Reader<span style=color:#f92672>&lt;</span>Resources<span style=color:#f92672>,</span> Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> Token<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>AuthenticateRequest request<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Reader<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>ctx <span style=color:#f92672>-&gt;</span>  
</span></span><span style=display:flex><span>                validate<span style=color:#f92672>(</span>cmd<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>findUser<span style=color:#f92672>(</span>ctx<span style=color:#f92672>))</span>  
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>Authenticate<span style=color:#f92672>::</span>checkPassword<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>                        <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>ar <span style=color:#f92672>-&gt;</span> right<span style=color:#f92672>(</span>Jwt<span style=color:#f92672>.</span><span style=color:#a6e22e>generateToken</span><span style=color:#f92672>(</span>ar<span style=color:#f92672>.</span><span style=color:#a6e22e>user</span><span style=color:#f92672>).</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>ctx<span style=color:#f92672>))));</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>There is a lot to unpack here so let&rsquo;s look at the function:</p><p>The Reader gives us Resources as input and as Output, we use the Either monad. The Either monad has a left side and right side. It is a convention that the left side indicates an error while the right side indicates a success state.</p><p>So in this case the error state is an ApiError and the success state is a Token.</p><p>The authenticate method takes one parameter and that is the AuthenticateRequest. This request object we will construct from the incoming HTTP request.</p><p>The method body consists of the call to the Reader&rsquo;s method which gives us access to the Resources instance.</p><p>The subsequent calls are the heart of the business logic. We will first validate the request, then look up the user from the database. The user&rsquo;s password is validated and if successful we generate the token.</p><h3 id=reader-monad>Reader Monad</h3><p>We use the Reader monad taken from: <a href=https://github.com/enelson/java_monads/blob/master/src/main/java/com/enelson/monads/Reader.java>https://github.com/enelson/java_monads/blob/master/src/main/java/com/enelson/monads/Reader.java</a>.</p><p>The Reader monad gives us a way to do dependency injection in a functional way.</p><h3 id=resources-class>Resources Class</h3><p>The Resources class is an immutable object which contains the dependencies required to operate. In this case, we need the UserRepository dependency to look up the user from the database.</p><p>Here are the classes for Resources and UserRepository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> lombok.Value<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> record <span style=color:#a6e22e>Resources</span><span style=color:#f92672>(</span>UserRepository userRepository<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The Resources is used as a data structure for all the I/O bound elements in your application. It would typically contain your data source, repositories and additional services needed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>  Try<span style=color:#f92672>&lt;</span>Option<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>findByEmail</span><span style=color:#f92672>(</span>Email email<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>We make use of the <a href=https://docs.vavr.io/#_try>Try</a> monad from Vavr as we do not want to throw any exception up the stack, but let the caller know that the operation failed.</p><p>Here is the definition of Try according to Vavr:</p><p>&ldquo;Try is a monadic container type that represents a computation that may either result in an exception or return a successfully computed value. It’s similar to, but semantically different from Either. Instances of Try, are either an instance of Success or Failure.&rdquo;</p><p>The findByEmail method takes an Email value object and returns a Try with an optional User. The Try monad wraps the function in a try-catch. The lookup to the database can fail at any point and we should cater for it by using the Try monad. We also get rid of exceptions in the method signature, getting rid of the &ldquo;goto&rdquo; which is the exception thrown and caught higher up the stack.</p><h3 id=validation>Validation</h3><p>Here is the validation method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> ValidAuthenticateRequest<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>validate</span><span style=color:#f92672>(</span>AuthenticateRequest cmd<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    Validation<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> Email<span style=color:#f92672>&gt;</span> email <span style=color:#f92672>=</span> Validations<span style=color:#f92672>.</span><span style=color:#a6e22e>email</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>.</span><span style=color:#a6e22e>email</span><span style=color:#f92672>());</span>  
</span></span><span style=display:flex><span>    Validation<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> Password<span style=color:#f92672>&gt;</span> password <span style=color:#f92672>=</span> Validations<span style=color:#f92672>.</span><span style=color:#a6e22e>password</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>.</span><span style=color:#a6e22e>password</span><span style=color:#f92672>());</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Validation<span style=color:#f92672>.</span><span style=color:#a6e22e>combine</span><span style=color:#f92672>(</span>email<span style=color:#f92672>,</span> password<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>ap</span><span style=color:#f92672>(</span>ValidAuthenticateRequest<span style=color:#f92672>::</span><span style=color:#66d9ef>new</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>toEither</span><span style=color:#f92672>()</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>mapLeft</span><span style=color:#f92672>(</span>ApiError<span style=color:#f92672>::</span>validationErrors<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Here we utilize Vavr&rsquo;s validation <a href=https://docs.vavr.io/#_validation>API</a> to validate the AuthenticateRequest and convert the email and password strings to proper types (Email, Password).</p><p>We return a Either here as a response to indicate success or failure.</p><h3 id=lookup-user-from-database>Lookup user from database</h3><p>Here is the &lsquo;findUser&rsquo; method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Function<span style=color:#f92672>&lt;</span>ValidAuthenticateRequest<span style=color:#f92672>,</span> Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> UserAndRequest<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>findUser</span><span style=color:#f92672>(</span>Resources ctx<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> validAuthenticateRequest <span style=color:#f92672>-&gt;</span> ctx<span style=color:#f92672>.</span><span style=color:#a6e22e>repositories</span><span style=color:#f92672>().</span><span style=color:#a6e22e>userRepository</span><span style=color:#f92672>()</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>findByEmail</span><span style=color:#f92672>(</span>validAuthenticateRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>email</span><span style=color:#f92672>())</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>toEither</span><span style=color:#f92672>()</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>mapLeft</span><span style=color:#f92672>(</span>ApiError<span style=color:#f92672>::</span>databaseError<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>flatMap</span><span style=color:#f92672>(</span>maybeUser <span style=color:#f92672>-&gt;</span> maybeUser<span style=color:#f92672>.</span><span style=color:#a6e22e>toEither</span><span style=color:#f92672>(</span>ApiError<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;User not found&#34;</span><span style=color:#f92672>)))</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>user <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>new</span> UserAndRequest<span style=color:#f92672>(</span>user<span style=color:#f92672>,</span> validAuthenticateRequest<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>This method is fairly straightforward, we call the findByEmail method, convert the Try to an Either, and map the exception to an ApiError (database error). If the user was not found, return an ApiError otherwise return the user and request as one immutable value.</p><h3 id=verify-user-password>Verify user password</h3><p>Here is the &lsquo;checkPassword&rsquo; function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> UserAndRequest<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>checkPassword</span><span style=color:#f92672>(</span>UserAndRequest t<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>t<span style=color:#f92672>.</span><span style=color:#a6e22e>user</span><span style=color:#f92672>().</span><span style=color:#a6e22e>password</span><span style=color:#f92672>().</span><span style=color:#a6e22e>matches</span><span style=color:#f92672>(</span>t<span style=color:#f92672>.</span><span style=color:#a6e22e>request</span><span style=color:#f92672>().</span><span style=color:#a6e22e>password</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> right<span style=color:#f92672>(</span>t<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> left<span style=color:#f92672>(</span>ApiError<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Incorrect password&#34;</span><span style=color:#f92672>));</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=generate-token>Generate token</h3><p>And lastly the &lsquo;generateToken&rsquo; function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Reader<span style=color:#f92672>&lt;</span>Resources<span style=color:#f92672>,</span> JwtToken<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>generateToken</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Reader<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>ctx <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        LocalDateTime now <span style=color:#f92672>=</span> LocalDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>now</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        LocalDateTime expires <span style=color:#f92672>=</span> now<span style=color:#f92672>.</span><span style=color:#a6e22e>plus</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> ChronoUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>DAYS</span><span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> Jwts<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>  
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setSubject</span><span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>())</span>  
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>claim</span><span style=color:#f92672>(</span>ROLE<span style=color:#f92672>,</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>role</span><span style=color:#f92672>())</span>  
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setExpiration</span><span style=color:#f92672>(</span>Date<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>expires<span style=color:#f92672>.</span><span style=color:#a6e22e>toInstant</span><span style=color:#f92672>(</span>ZoneOffset<span style=color:#f92672>.</span><span style=color:#a6e22e>UTC</span><span style=color:#f92672>)))</span>  
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>signWith</span><span style=color:#f92672>(</span>ctx<span style=color:#f92672>.</span><span style=color:#a6e22e>security</span><span style=color:#f92672>().</span><span style=color:#a6e22e>secretKey</span><span style=color:#f92672>(),</span> SignatureAlgorithm<span style=color:#f92672>.</span><span style=color:#a6e22e>HS512</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>compact</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JwtToken<span style=color:#f92672>(</span>token<span style=color:#f92672>,</span> expires<span style=color:#f92672>.</span><span style=color:#a6e22e>atZone</span><span style=color:#f92672>(</span>ZoneId<span style=color:#f92672>.</span><span style=color:#a6e22e>systemDefault</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>toInstant</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toEpochMilli</span><span style=color:#f92672>());</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>});</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>This function utilizes the &lsquo;jsonwebtoken&rsquo; <a href=https://jwt.io/>https://jwt.io/</a>.</p><p>The last part is to connect the server with the business function. This is where we have to unfortunately go back to the imperative way as I have not found a good server-side library that does HTTP in a functional manner (Although Spring Cloud Functions look promising). But for our purposes, it will suffice.</p><h3 id=controller-class>Controller Class</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityController</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Resources resources<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>Context ctx<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>       Authenticate<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>getAuthenticateRequest<span style=color:#f92672>(</span>ctx<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                   <span style=color:#f92672>.</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>resources<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                   <span style=color:#f92672>.</span><span style=color:#a6e22e>fold</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                       err <span style=color:#f92672>-&gt;</span> context<span style=color:#f92672>.</span><span style=color:#a6e22e>json</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ErrorResponse<span style=color:#f92672>(</span>apiError<span style=color:#f92672>.</span><span style=color:#a6e22e>getErrors</span><span style=color:#f92672>())).</span><span style=color:#a6e22e>status</span><span style=color:#f92672>(</span>HttpStatus<span style=color:#f92672>.</span><span style=color:#a6e22e>BAD_REQUEST_400</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                       token <span style=color:#f92672>-&gt;</span> context<span style=color:#f92672>.</span><span style=color:#a6e22e>json</span><span style=color:#f92672>(</span>payload<span style=color:#f92672>).</span><span style=color:#a6e22e>status</span><span style=color:#f92672>(</span>HttpStatus<span style=color:#f92672>.</span><span style=color:#a6e22e>OK_200</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                   <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The controller class is where we link the Rest API to our business function.</p><h3 id=wire-in-controller>Wire in controller</h3><p>And wiring in the controller:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> io.javalin.Javalin<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        var resources <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Resources<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        var securityController <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SecurityController<span style=color:#f92672>(</span>resources<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>        Javalin app <span style=color:#f92672>=</span> Javalin<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>cfg <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>            cfg<span style=color:#f92672>.</span><span style=color:#a6e22e>enableDevLogging</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>            cfg<span style=color:#f92672>.</span><span style=color:#a6e22e>enableCorsForAllOrigins</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        app<span style=color:#f92672>.</span><span style=color:#a6e22e>routes</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            path<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                post<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/authenticate&#34;</span><span style=color:#f92672>,</span> securityController<span style=color:#f92672>::</span>authenticate<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        app<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>(</span>8080<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=testing-our-application>Testing our application</h3><p>We have just implemented our business logic as a function, which helps quite a lot with testing it. We can now only test this function and be confident it works. Of course, the API also needs to be tested, for this post we will focus on testing the function. We will be using Junit with AssertJ to write our tests.</p><p>Here is the complete test:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticateTest</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Resources resources <span style=color:#f92672>=</span> TestResourcesFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldAuthenticateWithCorrectCredentials</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Given  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        AuthenticateRequest cmd <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin@local.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// When  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> JwtToken<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> Authenticate<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>).</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>io<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Then  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>isRight</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>().</span><span style=color:#a6e22e>token</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>().</span><span style=color:#a6e22e>hasSizeGreaterThan</span><span style=color:#f92672>(</span>200<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ParameterizedTest</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MethodSource</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;provideArgumentsForAuthenticateFailures&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shouldReturnError</span><span style=color:#f92672>(</span>AuthenticateRequest cmd<span style=color:#f92672>,</span> String errorMessage<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        Either<span style=color:#f92672>&lt;</span>ApiError<span style=color:#f92672>,</span> JwtToken<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> Authenticate<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>cmd<span style=color:#f92672>).</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>io<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Then  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>isLeft</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>swap</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>isNotNull</span><span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        assertThat<span style=color:#f92672>(</span>result<span style=color:#f92672>.</span><span style=color:#a6e22e>swap</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>hasToString</span><span style=color:#f92672>(</span>errorMessage<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Stream<span style=color:#f92672>&lt;</span>Arguments<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>provideArgumentsForAuthenticateFailures</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Stream<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>  
</span></span><span style=display:flex><span>                Arguments<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Pass1234&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;Invalid email specified&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                Arguments<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin@local.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;Password cannot be empty&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                Arguments<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin@abc.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Pass1234&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;User not found&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                Arguments<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;a@a.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Pass1234&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;User not found&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                Arguments<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> AuthenticateRequest<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin@local.com&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;password&#34;</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;Incorrect password&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>        <span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>And the TestResourceFactory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestResourcesFactory</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> SecretKey SECRET_KEY <span style=color:#f92672>=</span> Keys<span style=color:#f92672>.</span><span style=color:#a6e22e>secretKeyFor</span><span style=color:#f92672>(</span>SignatureAlgorithm<span style=color:#f92672>.</span><span style=color:#a6e22e>HS512</span><span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Resources <span style=color:#a6e22e>create</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>          
</span></span><span style=display:flex><span>        var userRepository <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TestUserRepository<span style=color:#f92672>();</span>  
</span></span><span style=display:flex><span>        var repositories <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Repositories<span style=color:#f92672>(</span>userRepository<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>        var security <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Security<span style=color:#f92672>(</span>SECRET_KEY<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Resources<span style=color:#f92672>(</span>repositories<span style=color:#f92672>,</span> security<span style=color:#f92672>);</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>And TestUserRepository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestUserRepository</span> <span style=color:#66d9ef>implements</span> UserRepository <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Set<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> users <span style=color:#f92672>=</span> HashSet<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span>  
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> Id<span style=color:#f92672>(),</span>  
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> Email<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin@local.com&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                    PasswordHash<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>),</span>  
</span></span><span style=display:flex><span>                    Role<span style=color:#f92672>.</span><span style=color:#a6e22e>ADMINISTRATOR</span><span style=color:#f92672>,</span>  
</span></span><span style=display:flex><span>                    LocalDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>now</span><span style=color:#f92672>(),</span>  
</span></span><span style=display:flex><span>                    LocalDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>now</span><span style=color:#f92672>())</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Try<span style=color:#f92672>&lt;</span>Option<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>findByEmail</span><span style=color:#f92672>(</span>Email email<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Try<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> users<span style=color:#f92672>.</span><span style=color:#a6e22e>find</span><span style=color:#f92672>(</span>user <span style=color:#f92672>-&gt;</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>email</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>email<span style=color:#f92672>)));</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Testing comes super easy with this approach as you can create abstracts of the IO in an in-memory representation.</p><p>This has been quite a lot to take in. The project is available here: <a href=https://github.com/johangwbasson/fp-in-java>https://github.com/johangwbasson/fp-in-java</a></p><p>Till next time.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/hugo-toha/hugo-toha.github.io/edit/main/content/posts/fp-applied-to-java/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://johanbasson.net#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:johangwbasson@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>johangwbasson@gmail.com</span></a></li><li><a href=https://github.com/johangwbasson target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>johangwbasson</span></a></li><li><a href=https://www.linkedin.com/in/johangwbasson target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Johan Basson</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+27787958927</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright Johan Basson.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>